---
phase: 04-integration
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: [commands/business/biz-link.md]
autonomous: true
---

<objective>
Implement entity linking command to create relationships between business design frameworks.

Purpose: Allow users to express connections like "this BMC targets this Persona" or "this VPC informs this SWOT".
Output: New biz:link command that updates linkedEntities arrays in entity JSON files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference implementations
@lib/storage.md
@lib/types.md
@commands/business/biz-new-project.md

# Prior plan outputs (for entity listing patterns)
@.planning/phases/04-integration/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create biz:link command</name>
  <files>commands/business/biz-link.md</files>
  <action>
Create command to link two business design entities with a relationship.

Usage: biz:link [source-id] [target-id]

Structure:
1. Check project exists
2. Parse source and target IDs from arguments (or prompt if not provided)
3. Look up both entities in project.json to get types
4. If either not found: error with available IDs
5. Ask for relationship type:
   - targets: Source targets the linked entity (e.g., BMC → Persona)
   - informs: Source is informed by linked entity (e.g., BMC → SWOT)
   - complements: Complementary analyses
   - validates: Source validates linked entity
6. Read source entity JSON
7. Add to linkedEntities array: { id, type, relationship }
8. Write updated source entity JSON
9. Display confirmation with both entities and relationship

Follow conductor pattern with frontmatter and XML structure.

Error handling:
- No project: "Run biz:new-project first"
- Entity not found: "Entity {id} not found. Use biz:list to see available entities."
- Self-link: "Cannot link entity to itself"
- Duplicate link: "Link already exists between {source} and {target}"
  </action>
  <verify>File exists at commands/business/biz-link.md with complete conductor structure</verify>
  <done>Command creates links between entities, updates linkedEntities array, handles all error cases</done>
</task>

<task type="auto">
  <name>Task 2: Add unlink functionality</name>
  <files>commands/business/biz-link.md</files>
  <action>
Extend biz:link to support removing links.

Usage: biz:link --remove [source-id] [target-id]

Add to existing command:
1. Check for --remove flag
2. If present, remove link instead of adding
3. Find link in linkedEntities array by target ID
4. If not found: "No link exists between {source} and {target}"
5. Remove from array
6. Write updated entity JSON
7. Display confirmation

Add documentation to command showing both usage patterns:
- biz:link [source] [target] — Create link
- biz:link --remove [source] [target] — Remove link
  </action>
  <verify>Command supports both --remove flag and regular linking</verify>
  <done>Both add and remove link functionality works, error cases handled</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] commands/business/biz-link.md exists with valid conductor structure
- [ ] Command creates links in linkedEntities array
- [ ] Command supports --remove flag for unlinking
- [ ] All four relationship types documented (targets, informs, complements, validates)
- [ ] Error messages are helpful and actionable
</verification>

<success_criteria>
- All tasks completed
- biz:link creates bidirectional awareness (source knows about target)
- Relationship types match lib/types.md definitions
- Command integrates with biz:list and biz:view output
</success_criteria>

<output>
After completion, create `.planning/phases/04-integration/04-02-SUMMARY.md`
</output>
